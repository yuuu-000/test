<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ファイル編集デモ（分岐対応）</title>
</head>
<body>
  <button id="openButton">ファイルを開く</button>
  <textarea id="editor" style="width: 100%; height: 300px;"></textarea>
  <button id="saveButton">保存</button>

  <script>
    let fileHandle;

    // 使用可能かチェック
    const isFileSystemAccessSupported = 'showOpenFilePicker' in window;

    document.getElementById('openButton').addEventListener('click', async () => {
      if (!isFileSystemAccessSupported) {
        alert('このブラウザはファイル操作に対応していません。ChromeまたはEdgeを使用してください。');
        return;
      }

      try {
        [fileHandle] = await window.showOpenFilePicker({
          types: [{
            description: 'Text Files',
            accept: {'text/plain': ['.txt']}
          }]
        });

        const file = await fileHandle.getFile();
        const contents = await file.text();
        document.getElementById('editor').value = contents;
      } catch (err) {
        console.error('ファイル読み込みエラー:', err);
      }
    });

    document.getElementById('saveButton').addEventListener('click', async () => {
      if (!isFileSystemAccessSupported || !fileHandle) {
        alert('保存できません。まずファイルを開いてください。');
        return;
      }

      try {
        const writable = await fileHandle.createWritable();
        await writable.write(document.getElementById('editor').value);
        await writable.close();
        alert('保存しました。');
      } catch (err) {
        console.error('保存エラー:', err);
      }
    });
  </script>
</body>
</html>

